<script aria-label="component-maker-js.html">

    let version = "1.0.202306181515"

    class CConfig {
        /** @type{} */
        #propMap = new Map()
    }
    class CData {
        data = {}
        /** @type {Map<string, PropertyDescriptor | undefined} */
        props = new Map()
        /** @type {Map<string, [string]>} */
        dependentPropList = new Map()
        /** @type {Map<string, string>} */
        bindings = new Map()

        /** @type {HTMLElement} */
        myElement = null
        /** @type {ShadowRoot} */
        myShadowRoot

        /** 
         * @param {{ele: HTMLElement, root: ShadowRoot}} c
        */
        constructor(c) {
            let { me, root } = c
            this.myElement = me
            this.myShadowRoot = root

            this.initiateMyElement()
        }

        initiateMyElement() {
            /** @type {CData} */
            let me2 = this

            Object.defineProperty(this.myElement, "data", {
                configurable: true, enumerable: true,
                get() { return me2.data },
                set(v) { me2.data = v }
            })


        }

        addProps() { }



    }
    class CUI {
        #shadowRoot
        #me


    }
    class CMaker {
        static get version() { return version }
        static async make(uiPth) {
            const uiGlblPth = "ui/components"
            
            try {
                let uiFullPth, uiHtml, uiScript, uiData, uiAttrs, uiEvts, uiEle, htmlParser;
                uiFullPth = `${uiGlblPth}/${uiPth}.html`
                uiHtml = await fetch(uiFullPth)
                uiHtml = await uiHtml.text()

                htmlParser = new DOMParser()
                uiEle = htmlParser.parseFromString(uiHtml, "text/html").body
                //uiEle = document.createElement("div")
                //uiEle.innerHTML = uiHtml
                
                uiScript = `
                let scrpt = (params) => {
                    let {me, root} = params
                    ${uiEle.querySelector("script").textContent}
                }

                return scrpt
                `
                uiEle.querySelector("script").remove()

                console.log({uiScript, uiEle})


                let lcc = class extends HTMLElement {
                    #cdata


                    constructor() {
                        super()
                        this.attachShadow({ mode: "open" })
                        let prm = { me: this, root: this.shadowRoot }
                        this.#cdata = new CData(prm)
                        
                        let func = Function(uiScript)
                        func(prm)
                        

                    }

                    set data(v) {
                        this.#cdata.data = v
                    }
                    //get props() { return this.#props }


                    /** @param {{derived:boolean}} options */
                    listProps(options) {
                        let { derived } = options
                        if (derived) return [...new Set([...this.#cdata.derivedProps.values()].flatMap(f => f))]
                        return [...this.#cdata.props.keys()]
                    }
                    /** 
                     * @desc {$prop1 : "data1.data2.leaf1", $prop2 : "data1.data2.leaf2"}
                     * @param {any} bindings - 
                    */
                    updateBindings(bindings) {

                    }

                }

                customElements.define("c-test-1", lcc)
                return lcc
            }
            catch (err) {
                console.log(err)
            }



        }
    }

</script>